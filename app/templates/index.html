<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="static/js/linkLoader.js"></script>
    <title>Index</title>
    <!-- Prevent FOUC -->
    <style>html{visibility: hidden;}</style>
</head>
<body>
    <div id="header-container">
        <span>Book Recommendation System Using Apriori Algorithm</span>
    </div>
    <div id="main-container">
        <div id="content">
            <form id="search-form" method="POST" autocomplete="off">
                <input type="text" id="search-term" placeholder="Cari buku..." required>
                <button type="submit" id="search-btn" title="Search">
                    <img src="static/assets/images/icon_search.png" alt="search-icon">
                </button>
            </form>
            <div id="item-container"></div>
        </div>
    </div>
    <script>
        const links = new Links([
            'main',
            'index',
            'icon_books'
        ]);
        links.generate();

        document.getElementById('search-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const searchTerm = document.getElementById('search-term').value;

            fetch('/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({ 'search_term': searchTerm })
            })
            .then(response => response.json())
            .then(data => {
                const itemContainer = document.getElementById('item-container');
                itemContainer.innerHTML = "";
                data.recommended_books.forEach((book) => {
                    let item = `
                    <div class="item-card">
                        <span class="item-img material-symbols-outlined">library_books</span>
                        <div class="item-information">
                            <span class="book-name">${book.judul_buku}</span>
                            <span class="book-author">${book.pengarang}</span>
                        </div>
                    </div>
                    `
                    itemContainer.innerHTML += item;
                });

                console.clear();
                console.log(
                    'Results: ', data['results'],
                    '\nRecommended_books: ', data['recommended_books'],
                );
            })
            .catch(error => {
                console.error("Error fetching data", error);
            });

            // // template
            // .then(data => {
            //     // Clear previous results
            //     document.getElementById('results-container').innerHTML = '';
            //     document.getElementById('recommended-books-container').innerHTML = '';

            //     // Display search results dynamically
            //     data.results.forEach(book => {
            //         const bookElement = document.createElement('div');
            //         bookElement.classList.add('book-item');
            //         bookElement.innerHTML = `<h3>${book.judul_buku}</h3><p>by ${book.pengarang}</p>`;
            //         document.getElementById('results-container').appendChild(bookElement);
            //     });

            //     // Display recommended books dynamically
            //     data.recommended_books.forEach(book => {
            //         const recommendedElement = document.createElement('div');
            //         recommendedElement.classList.add('book-item');
            //         recommendedElement.innerHTML = `<h3>${book.judul_buku}</h3><p>by ${book.pengarang}</p><p>Support: ${book.support}</p><p>Confidence: ${book.confidence}</p><p>Lift: ${book.lift}</p>`;
            //         document.getElementById('recommended-books-container').appendChild(recommendedElement);
            //     });
            // });
        });
    </script>
</body>
</html>